---
title: "Regression"
author: ""
date: "2024-04-12"
output: html_document
---
# Definér de forskellige variable
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dynlm)
library(lmtest)
library(dplyr)
library(texreg)
data <- read_excel("Makroøkonomisk projekt.xlsx")
gdp <- data$gdp_pct_change
china <- data$`China gdp year ago`
unemp <- data$unemp
inf <- data$`HPI: growth same period previous year`
pri_con <- data$`Real private consumption: https://fred.stlouisfed.org/series/NAEXKP02DEQ657S`
energy <- data$`Consumer Price Index: OECD Groups: Energy (Fuel, Electricity, and Gasoline): Total for Germany, Change, Growth rate same period previous year, Quarterly, Not Seasonally Adjusted`
gdp_yearago<-data$`Real GDP percent year ago`
eurozone<-data$`Eurozonen: Real GDP growth quarterly previous period`
fx<- data$`Exchange rate`
exp <- data$`Real Export - % change from year ago`
rente <- data$`Interest Rate (10-year Goverment Bond Yields)`
G <- data$`Germany Fiscal Expenditure EUR Billion.`
ULC<-data$`ULC pct change previous period`
produktivitet<-data$`Productivity output per hour worked (mining and manufacturing)`
import<-data$`Real Import - % change from year ago`
USA<-data$`USA real gdp percent year ago`
eurozone_pct_year<-data$`New eurozone gdp year ago`
```

# Regressionsmodel for BNP
```{r}
mod <- lm(gdp_yearago~exp+inf+lag(energy,4)+rente+unemp)
plot(mod, which=1)
hist(residuals(mod))
bptest(mod)
summary(mod)
```

#Tilføjelse af produktivitet, ULC, FX
```{r}
mod2 <- lm(gdp_yearago~exp+inf+lag(energy,4)+lag(rente,4)+eurozone+unemp+import+log(produktivitet)+ULC+fx)
plot(mod, which=1)
hist(residuals(mod))
bptest(mod)
summary(mod)
```

# Model som godt kan bruges (mangler USA data og tjek eurozone skal være year ago)
```{r}
model_standard <- lm(gdp_yearago~exp+rente+lag(ULC,3)+eurozone+china)
plot(model_standard, which=2)
hist(residuals(model_standard))
bptest(model_standard)
summary(model_standard)
```


Argumentet for at vi undlader arbejdsløsheden
```{r}
plot(unemp, type = "l", col = "blue", ylim = c(-10, 15),)
lines(gdp_yearago)
```


# NYT FORSØG hvor vi finder ud af at det ikke giver mening med hverken inflation eller energy. STANDARD MODEL
```{r}
nytforsøg<-lm(gdp_yearago~exp+lag(rente,6)+lag(ULC,3)+lag(china,2)+lag(USA,1)+eurozone_pct_year)
summary(nytforsøg)
```



```{r}
plot(nytforsøg)
```

#Fjerner outliers
```{r}
outliers <- c(37,81,82,83,84,85, 86, 87,88,89)
data_clean <- data[-outliers,]
gdp_clean <- data_clean$gdp_pct_change; exp_clean <- data_clean$`Real Export - % change from year ago`; rente_clean <- data_clean$`Interest Rate (10-year Goverment Bond Yields)`; ULC_clean <- data_clean$`ULC pct change previous period`; china_clean <- data_clean$`China gdp year ago`; USA_clean <- data_clean$`USA real gdp percent year ago`; euro_clean <- data_clean$`Eurozonen: Real GDP growth quarterly previous period`

nytforsøg2 <- lm(gdp_clean ~ exp_clean + lag(rente_clean, 6) + lag(ULC_clean, 3) + lag(china_clean, 2) + lag(USA_clean, 1) + euro_clean)
summary(nytforsøg2)
plot(nytforsøg2)
```

#Forsøg med LAD
```{r}
library(quantreg); library(stargazer)
rqmod <- rq(gdp_yearago~exp+lag(rente,6)+lag(ULC,3)+lag(china,2)+lag(USA,1)+eurozone_pct_year)
stargazer(nytforsøg, rqmod, type="text")
```



# Korrelation for hhv. USA og Eurozonen
```{r}
cor(gdp_yearago[1:95], USA[1:95])
cor(gdp_yearago[1:95], eurozone_pct_year[1:95])
```




#Standard model: År 2000-2008
```{r}
mod_2000<-lm(gdp_yearago[1:33]~exp[1:33]+lag(rente[1:33],6)+lag(ULC[1:33],3)+lag(china[1:33],2)+lag(USA[1:33],1)+eurozone_pct_year[1:33])
summary(mod_2000)
```
```{r}
plot(mod_2000)
```



#Standard model 2010-2019
```{r}
mod_2010<-lm(gdp_yearago[42:81]~exp[42:81]+lag(rente[42:81],6)+lag(ULC[42:81],3)+lag(china[42:81],2)+lag(USA[42:81],1)+eurozone_pct_year[42:81])
summary(mod_2010)
```

```{r}
plot(mod_2010)
```


#Standard model for 2015Q1-2023Q3
```{r}
mod_2020<-lm(gdp_yearago[62:96]~exp[62:96]+lag(rente[62:96],6)+lag(ULC[62:96],3)+lag(china[62:96],2S)+lag(USA[62:96],1)+eurozone_pct_year[62:96])
summary(mod_2020)
```

```{r}
plot(mod_2020)
```


```{r}
screenreg(list("Hele perioden"=nytforsøg, "2000-2008"=mod_2000, "2010-2019"=mod_2010, "2015-2023"=mod_2020))
```


```{r}
plot(gdp_yearago, type="l", col="blue", ylim=c(-10,20))
lines(USA, type="l", col="red")
lines(china, type="l", col="green")
```



# Forsøg med eksport som afhængig variabel
```{r}
reg_eksport<-lm(exp~ULC)
summary(reg_eksport)
```



```{r}
plot(gdp, ylim=c(-15,15), type="l", col="blue")
lines(exp, type="l", col="red")
lines(100*gov_con_log[1:96], type="l", col="black")
lines(energy, type="l", col="green")
energy <- na.omit(energy)
```

Procentvis ændring for gov exp
```{r}
gov_con_log <- c(NA, diff(gov_con)/lag(gov_con))
gov_con_log <- gov_con_log[2:97]
```



Regressionsmodel for export
```{r}
reg_exp <- lm(exp[1:90] ~ china[1:90] + lag(energy[1:90], 2))
summary(reg_exp)
```


```{r}
 # Libraries for dynamic lm, regression table and F tests
library(dynlm);library(lmtest);library(car)
data(data, package=’wooldridge’)# Define Yearly time series beginning in 1913
tsdata <- ts(fertil3, start=1913) # Linear regression of model with lags:
res <- dynlm(gfr ~ pe + L(pe) + L(pe,2) + ww2 + pill, data=tsdata)
coeftest(res)
```


```{r}
plot(exp, type="l", col="blue")
lines(USA)
```



